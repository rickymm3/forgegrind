<% egg = user_egg.egg %>
<% image_path = egg_image_path(egg) %>
<% remaining_seconds = user_egg.hatch_time_remaining %>
<% status_label =
     if user_egg.hatched?
       "Hatched"
     elsif user_egg.hatching?
       remaining_seconds <= 0 ? "Ready to hatch" : "#{distance_of_time_in_words(Time.current, Time.current + remaining_seconds)} remaining"
     else
       "Waiting to incubate"
     end %>

<div class="divider mb-4 flex items-start justify-between gap-6">
  <div class="space-y-1">
    <p class="text-xs uppercase tracking-wide text-amber-200">Egg Profile</p>
    <h2 class="text-2xl font-semibold text-slate-100"><%= egg.name %></h2>
    <p class="text-xs text-slate-400"><%= status_label %></p>
  </div>
  <%= link_to user_pets_path(collection: "eggs"),
              class: "inline-flex items-center justify-center rounded-full bg-slate-800/70 p-2 text-slate-300 transition hover:text-white",
              aria: { label: "Close egg details" } do %>
    <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5">
      <path d="M6 6l12 12" />
      <path d="M18 6L6 18" />
    </svg>
  <% end %>
</div>

<div class="relative mb-6 aspect-[3/4] overflow-hidden rounded-3xl border border-slate-800 bg-slate-900/60">
  <% if image_path.present? %>
    <%= image_tag image_path,
                  alt: "",
                  loading: "lazy",
                  class: "absolute inset-0 h-full w-full object-cover" %>
  <% else %>
    <div class="absolute inset-0 flex items-center justify-center text-sm text-slate-300">
      No artwork available
    </div>
  <% end %>
  <span class="absolute top-3 right-3 inline-flex items-center rounded-full bg-slate-950/80 px-3 py-1 text-xs font-semibold text-amber-200 drop-shadow">
    <% if egg.currency %>
      <%= "#{egg.currency.symbol} #{egg.cost_amount}" %>
    <% else %>
      Cost: <%= egg.cost_amount %>
    <% end %>
  </span>
</div>

<div class="space-y-4 rounded-2xl border border-slate-800 bg-slate-900/60 p-4">
  <h3 class="text-sm font-semibold uppercase tracking-wide text-slate-300">Hatching Steps</h3>
  <ol class="list-decimal space-y-2 pl-4 text-sm text-slate-200">
    <li>Begin incubation to start the timer.</li>
    <li>Return when the timer finishes to hatch the egg.</li>
    <li>Newly hatched pets will appear in your Pets list.</li>
  </ol>
  <% if user_egg.hatching? %>
    <p class="text-xs text-slate-400">
      Hatch ETA:
      <span class="font-semibold text-amber-200">
        <% if remaining_seconds <= 0 %>
          Ready now
        <% else %>
          <%= distance_of_time_in_words(Time.current, Time.current + remaining_seconds, include_seconds: false) %>
        <% end %>
      </span>
    </p>
  <% else %>
    <p class="text-xs text-slate-400">
      Incubation time:
      <span class="font-semibold text-amber-200">
        <%= distance_of_time_in_words(Time.current, Time.current + egg.hatch_duration.seconds) %>
      </span>
    </p>
  <% end %>
</div>

<div class="mt-6 flex flex-wrap items-center justify-between gap-3">
  <% if user_egg.hatched? %>
    <span class="inline-flex items-center rounded-full bg-emerald-600/20 px-3 py-2 text-xs font-semibold text-emerald-200">
      Already hatched
    </span>
  <% elsif user_egg.hatching? %>
    <% if remaining_seconds <= 0 %>
      <%= button_to "Mark ready to hatch",
                    mark_ready_user_egg_path(user_egg),
                    method: :post,
                    form: { data: { turbo: false } },
                    class: "inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-emerald-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400 focus-visible:ring-offset-2 focus-visible:ring-offset-slate-950" %>
    <% else %>
      <span class="inline-flex items-center rounded-full bg-amber-500/20 px-3 py-2 text-xs font-semibold text-amber-200">
        Incubating
      </span>
    <% end %>
  <% else %>
    <%= button_to "Begin incubation",
                  incubate_user_egg_path(user_egg),
                  method: :post,
                  form: { data: { turbo: false } },
                  class: "inline-flex items-center gap-2 rounded-full bg-indigo-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-indigo-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-400 focus-visible:ring-offset-2 focus-visible:ring-offset-slate-950" %>
  <% end %>
  <%= link_to "Close",
              user_pets_path(collection: "eggs"),
              class: "inline-flex items-center justify-center rounded-full border border-slate-700/70 bg-slate-900/60 px-4 py-2 text-sm font-semibold text-slate-200 transition hover:text-white" %>
</div>
