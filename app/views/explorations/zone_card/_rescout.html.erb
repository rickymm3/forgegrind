<% generated ||= nil %>
<% user_exploration ||= nil %>
<% can_rescout = generated &&
                 !generated.consumed? &&
                 (user_exploration.blank? || user_exploration.complete?) &&
                 generated.slot_state_sym != :cooldown %>

<% if can_rescout %>
  <% reroll_seconds = generated.reroll_cooldown_remaining_seconds %>
  <% reroll_disabled = reroll_seconds.positive? %>
  <% reroll_wait = nil %>
  <% if reroll_disabled %>
    <% available_time = generated.reroll_available_at || (Time.current + reroll_seconds.seconds) %>
    <% reroll_wait = distance_of_time_in_words(Time.current, available_time) %>
  <% end %>
  <div class="zone-rescout">
    <%= button_to "Rescout Expedition",
                  reroll_exploration_path(generated),
                  method: :post,
                  class: "zone-rescout__button",
                  disabled: reroll_disabled,
                  form: { data: { turbo_confirm: "Replace this expedition with a fresh route?", turbo_frame: "_top" } } %>
    <% if reroll_wait.present? %>
      <p class="zone-rescout__note">Available in <%= reroll_wait %></p>
    <% end %>
  </div>
<% end %>
