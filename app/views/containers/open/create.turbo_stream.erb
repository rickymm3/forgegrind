<% currency_balances = @currency_balances || helpers.currency_balances_for(current_user) %>
<% diamonds = currency_balances.find { |c| c.name == "Diamonds" } %>

<%= turbo_stream.replace "currency_balances",
                         partial: "shared/currency_badges",
                         locals: { currencies: currency_balances } %>

<%= turbo_stream.replace "inventory-containers-grid",
                         partial: "inventories/containers_grid",
                         locals: { containers: @containers } %>

<%= turbo_stream.replace "inventory-items-grid",
                         partial: "inventories/items_grid",
                         locals: { items: @items } %>

<%= turbo_stream.update "inventory-containers-count" do %>
  <%= @containers_total %>
<% end %>

<%= turbo_stream.update "inventory-items-count" do %>
  <%= @items_total %>
<% end %>

<%= turbo_stream.replace "inventory-detail-panel",
                         partial: "inventories/detail_panel",
                         locals: { state: :idle } %>

<%= turbo_stream.replace "container-open-errors", "" %>

<%= turbo_stream.replace "container-reveal",
                         partial: "containers/reveal",
                         locals: { payload: @rewards_payload, container_lookup: @container_lookup } %>

<%= turbo_stream.update diamonds&.dom_id || currency_dom_id("Diamonds") do %>
  <%= number_with_delimiter(diamonds&.amount.to_i) %>
<% end %>
