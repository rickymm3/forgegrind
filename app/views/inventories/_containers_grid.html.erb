<div id="inventory-containers-grid">
  <% if containers.blank? %>
    <div class="rounded-3xl border border-slate-800 bg-slate-900/60 px-6 py-10 text-center text-sm text-slate-300">
      Earn boxes by completing explorations. Rewards include pet care supplies, currency, and rare bonuses.
    </div>
  <% else %>
    <div class="grid grid-cols-2 gap-3 sm:grid-cols-3 lg:grid-cols-4">
      <% containers.each do |container| %>
        <% chest = container.chest_type %>
        <% next unless chest %>
        <% count = container.count.to_i %>
        <% frame_class = chest_frame_class(chest) %>
        <% icon_path = chest_icon_path(chest) %>
        <div class="space-y-2">
          <%= link_to container_panel_inventory_path(key: chest.key),
                      data: { turbo_frame: "inventory-detail-panel", turbo_method: :post },
                      class: "group relative block aspect-square overflow-hidden rounded-3xl border-2 #{frame_class} bg-slate-900/60 shadow-inner shadow-slate-950/40 transition focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-400 focus-visible:ring-offset-2 focus-visible:ring-offset-slate-950 hover:scale-[1.01]" do %>
            <span class="sr-only"><%= chest.name %></span>
            <% if icon_path.present? %>
              <%= image_tag icon_path,
                            alt: "",
                            class: "absolute inset-0 h-full w-full object-contain p-4 transition duration-200 group-hover:scale-105" %>
            <% else %>
              <div class="absolute inset-0 flex items-center justify-center text-sm text-slate-300">No Art</div>
            <% end %>
            <span class="absolute bottom-2 right-2 inline-flex items-center rounded-full bg-indigo-600/90 px-3 py-1 text-[11px] font-semibold text-white shadow-md">
              x<%= count %>
              <span class="sr-only">owned</span>
            </span>
            <span class="absolute top-2 left-2 inline-flex items-center rounded-full bg-slate-950/80 px-2 py-1 text-[10px] font-semibold uppercase tracking-wide text-indigo-200">
              Level <%= chest.min_level %>
            </span>
          <% end %>

          <div class="flex items-center justify-between text-xs text-slate-400">
            <span class="font-semibold text-slate-100 text-sm truncate"><%= chest.name %></span>
            <span><%= container_count_badge_text(count) %></span>
          </div>

          <div class="flex flex-wrap gap-2">
            <%= render "inventories/container_open_form",
                       chest: chest,
                       quantity: 1,
                       label: "Open",
                       css: "inline-flex items-center gap-2 rounded-full bg-indigo-600 px-3 py-1.5 text-[11px] font-semibold text-white transition hover:bg-indigo-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-400 focus-visible:ring-offset-2 focus-visible:ring-offset-slate-950",
                       disabled: count.zero? %>

            <% if chest.open_batch_allowed? && count >= 5 %>
              <%= render "inventories/container_open_form",
                         chest: chest,
                         quantity: 5,
                         label: "Ã—5",
                         css: "inline-flex items-center gap-2 rounded-full bg-slate-800 px-3 py-1.5 text-[11px] font-semibold text-slate-200 transition hover:bg-slate-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-400 focus-visible:ring-offset-2 focus-visible:ring-offset-slate-950",
                         disabled: count < 5 %>
            <% end %>

            <% if chest.open_batch_allowed? && count > 1 %>
              <%= render "inventories/container_open_form",
                         chest: chest,
                         quantity: count,
                         label: "All",
                         css: "inline-flex items-center gap-2 rounded-full bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white transition hover:bg-emerald-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400 focus-visible:ring-offset-2 focus-visible:ring-offset-slate-950",
                         disabled: count.zero? %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
