<h1 class="text-3xl font-bold text-slate-900 mb-4">Pet Badges</h1>

<div class="flex items-center justify-between mb-6">
  <p class="text-sm text-slate-500">Configure badge requirements tied to care tracker sliders.</p>
  <%= link_to "New Badge", new_admin_badge_path, class: "inline-flex items-center rounded-full bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-500" %>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
  <% @badges.each do |key, badge| %>
    <div class="rounded-3xl border border-slate-200 bg-white p-5 space-y-3">
      <div class="flex items-center justify-between">
        <div class="space-y-1">
          <h2 class="text-lg font-semibold text-slate-900"><%= badge["label"] %></h2>
          <p class="text-xs uppercase tracking-[0.3em] text-slate-400"><%= key %></p>
        </div>
        <div class="flex items-center gap-2">
          <%= link_to "Edit", edit_admin_badge_path(key), class: "text-xs font-semibold text-indigo-600 hover:text-indigo-500" %>
          <%= link_to "Delete",
                      admin_badge_path(key),
                      method: :delete,
                      data: { turbo_confirm: "Delete #{badge['label']}?" },
                      class: "text-xs font-semibold text-rose-600 hover:text-rose-500" %>
        </div>
      </div>
      <% if badge["description"].present? %>
        <p class="text-sm text-slate-600"><%= badge["description"] %></p>
      <% end %>
      <div class="text-xs text-slate-500 flex flex-wrap gap-2">
        <span class="inline-flex items-center rounded-full bg-slate-100 px-2 py-1 font-semibold">Category: <%= badge["category"].presence || "care" %></span>
        <span class="inline-flex items-center rounded-full bg-slate-100 px-2 py-1 font-semibold">Color: <%= badge["color"].presence || "default" %></span>
        <span class="inline-flex items-center rounded-full bg-slate-100 px-2 py-1 font-semibold">Transfers: <%= badge["transfers_on_level_up"] ? "Yes" : "No" %></span>
      </div>
      <% tracker_conditions = Array(badge.dig("conditions", "all")) %>
      <% if tracker_conditions.any? %>
        <div>
          <p class="text-xs font-semibold text-slate-500 mb-1">Tracker requirements</p>
          <ul class="text-sm text-slate-700 list-disc pl-5 space-y-1">
            <% tracker_conditions.each do |condition| %>
              <li><%= "#{condition['key']} #{condition['type'] == 'tracker_at_most' ? '≤' : '≥'} #{condition['value']}" %></li>
            <% end %>
          </ul>
        </div>
      <% end %>
      <% overrides = Array(badge.dig("overrides", "remove")) %>
      <% if overrides.any? %>
        <div>
          <p class="text-xs font-semibold text-slate-500 mb-1">Removes</p>
          <div class="flex flex-wrap gap-2">
            <% overrides.each do |override| %>
              <span class="inline-flex items-center rounded-full bg-rose-50 px-2 py-1 text-xs font-semibold text-rose-700"><%= override %></span>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
