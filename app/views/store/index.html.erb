<% content_for :title, "Store" %>
<% content_for :main_class, "px-0 pt-4 flex flex-col" %>
<% content_for :main_inner_class, "px-4 flex flex-col h-full" %>

<% tabs = { "items" => "Items", "eggs" => "Eggs" } %>
<% header_body = render("store/header_body", tabs: tabs, active_tab: @active_tab, condensed: true, currencies: @currency_balances) %>

<% content_for :header do %>
  <%= render "shared/page_header",
             title: "Marketplace",
             subtitle: "Browse limited-time eggs and curated bundles.",
             class: "page-header--condensed",
             body: header_body %>
<% end %>

<div class="mx-auto w-full max-w-5xl flex-1 space-y-6">
  <% case @active_tab %>
  <% when "items" %>
    <section class="space-y-2">
      <%= turbo_frame_tag "store-item-hero", class: "store-item-hero-frame sticky top-4 z-10" do %>
        <%= render "store/items_hero", offer: @selected_offer, currency_balances: @currency_balances, hero: true %>
      <% end %>

      <% if @pet_care_offers.present? %>
        <div class="store-item-grid grid grid-cols-4 gap-2 overflow-y-auto pb-6 mt-2" style="max-height: 50vh;">
          <% @pet_care_offers.each do |offer| %>
            <% item = offer[:item] %>
            <% icon_path = care_item_image_path(item.item_type) %>
            <%= link_to store_path(tab: "items", item_type: offer[:item_type]),
                        data: { turbo_frame: "store-item-hero" },
                        class: "store-item-card" do %>
              <div class="store-item-slot">
                <% if icon_path.present? %>
                  <%= image_tag icon_path, alt: item.name, class: "store-item-icon" %>
                <% else %>
                  <span class="store-item-fallback"><%= item.name.first %></span>
                <% end %>
              </div>
            <% end %>
          <% end %>
        </div>
      <% else %>
        <div class="rounded-3xl border border-slate-800 bg-slate-950/70 p-8 shadow-inner shadow-slate-950/40">
          <div class="space-y-4 text-center text-slate-300">
            <h2 class="text-xl font-semibold text-slate-100">Items arriving soon</h2>
            <p class="text-sm">
              The Forge is still crafting consumables and gear. Check back later for limited-time bundles and seasonal offerings.
            </p>
          </div>
        </div>
      <% end %>
    </section>
  <% when "eggs" %>
    <section class="space-y-6">
      <div id="store-eggs-carousel">
        <%= render "eggs_carousel", eggs: @eggs, highlighted_egg_id: @highlighted_egg_id %>
      </div>
    </section>
  <% else %>
    <p class="rounded-3xl border border-rose-500/30 bg-rose-500/10 p-4 text-sm text-rose-100">
      Unknown tab.
    </p>
  <% end %>
</div>
